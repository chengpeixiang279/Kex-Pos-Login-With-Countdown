import React, { useEffect, useState } from "react";

export default function KexPosLoginWithCountdown() {
  const [status, setStatus] = useState<"NORMAL" | "COUNTDOWN" | "LOCKED">("COUNTDOWN");
  const [remaining, setRemaining] = useState<number>(7200); // 2 hours
  const [showModal, setShowModal] = useState<boolean>(false);

  const overdueDays = 3;
  const outstandingAmount = "12,450 THB";

  useEffect(() => {
    if (status !== "COUNTDOWN") return;

    const timer = setInterval(() => {
      setRemaining((prev) => {
        if (prev <= 1) {
          clearInterval(timer);
          setStatus("LOCKED");
          setShowModal(true);
          return 0;
        }
        return prev - 1;
      });
    }, 1000);

    return () => clearInterval(timer);
  }, [status]);

  const formatTime = (seconds: number) => {
    const h = String(Math.floor(seconds / 3600)).padStart(2, "0");
    const m = String(Math.floor((seconds % 3600) / 60)).padStart(2, "0");
    const s = String(seconds % 60).padStart(2, "0");
    return `${h}:${m}:${s}`;
  };

  const handleLogin = () => {
    if (status !== "NORMAL") {
      setShowModal(true);
      return;
    }
    alert("Login Success (Demo)");
  };

  return (
    <div className="w-full h-screen bg-white flex items-center justify-center font-sans relative">
      <div className="w-[440px]">
        <div className="border-4 border-orange-500 text-orange-500 px-8 py-2 text-3xl font-bold tracking-widest text-center mb-8">
          KEX
        </div>

        {status === "COUNTDOWN" && (
          <div className="border border-orange-400 bg-orange-50 text-orange-700 p-4 mb-5 text-sm">
            <div className="font-semibold mb-1">Remittance Overdue Notice</div>
            <div>Overdue Days: {overdueDays}</div>
            <div>Outstanding: {outstandingAmount}</div>
            <div className="mt-2">
              Lock in:
              <div className="text-lg font-bold mt-1">
                {formatTime(remaining)}
              </div>
            </div>
          </div>
        )}

        <div className="mb-4">
          <div className="text-gray-700 mb-1">User:</div>
          <input
            className="w-full border-b border-gray-400 outline-none px-2 py-1"
            defaultValue="junuatpos03"
          />
        </div>

        <div className="mb-6">
          <div className="text-gray-700 mb-1">Password:</div>
          <input
            type="password"
            className="w-full border-b border-gray-400 outline-none px-2 py-1"
          />
        </div>

        <button
          onClick={handleLogin}
          className="w-full py-2 bg-orange-500 hover:bg-orange-600 text-white font-semibold"
        >
          Login
        </button>
      </div>

      {showModal && (
        <div className="absolute inset-0 bg-black bg-opacity-40 flex items-center justify-center">
          <div className="bg-white w-[360px] p-6 border border-red-500">
            <div className="text-red-600 font-semibold text-lg mb-3">
              Payment Required
            </div>
            <div className="text-sm">Outstanding: {outstandingAmount}</div>
            <div className="text-sm">Overdue Days: {overdueDays}</div>
            <div className="mt-4 text-sm">
              POS login is restricted until payment is confirmed by Finance.
            </div>
            <button
              onClick={() => setShowModal(false)}
              className="mt-6 w-full py-2 bg-red-500 text-white font-semibold"
            >
              Confirm
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

